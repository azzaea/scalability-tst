include required(classpath("application"))

system { # limiting the rate of job submission because SLURM scheduler can get overloaded when hit with scattering jobs all at once
  job-rate-control {
    jobs = 16 
#    per = 1 second
  }
}

backend {
  default = slurm
  providers {
    slurm {
     actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
     config {
      runtime-attributes = """
        Int cpu=1
        String queue = "normal"
      """
      submit = """
        sbatch -J ${job_name} -D ${cwd} -o ${out} -e ${err} -p ${queue} ${"-c " + cpu} --wrap "/bin/bash ${script}"
      """
      kill = "scancel ${job_id}"
      check-alive = "squeue -j ${job_id}"
      job-id-regex = "Submitted batch job (\\d+).*"
     }
    }
  }
}

